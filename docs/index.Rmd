---
title: "Assessment"
author: "Naveed"
date: "2024-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



The MAIN Research Question
How does the prescription of antibiotics for hospital acquired infections vary across


## The Libraries

This section contains the code for loading in all the required libraries. 

```{r}
library(tidyverse)
library(here)
library(janitor)
library(gt)
```

## The Data

This section contains the code for loading in all the required datasets. 

```{r pressure, echo=FALSE}
data_aug2024 <- read_csv("https://www.opendata.nhs.scot/dataset/84393984-14e9-4b0d-a797-b288db64d088/resource/a42762ac-47cb-4fb6-b9b1-2478a588c0ed/download/pitc202403.csv") %>% 
  clean_names()
data_july2024 <- read_csv("https://www.opendata.nhs.scot/dataset/84393984-14e9-4b0d-a797-b288db64d088/resource/1cb425fc-640c-4b37-9013-f8e97f274085/download/pitc202407.csv") %>% 
  clean_names()
hb_data <- read_csv("https://www.opendata.nhs.scot/dataset/9f942fdb-e59e-44f5-b534-d6e17229cc7b/resource/652ff726-e676-4a20-abda-435b98dd7bdc/download/hb14_hb19.csv") %>% 
  clean_names()
special_hb_data <- read_csv("https://www.opendata.nhs.scot/dataset/65402d20-f0f1-4cee-a4f9-a960ca560444/resource/0450a5a2-f600-4569-a9ae-5d6317141899/download/special-health-boards_19022021.csv") %>% 
  clean_names()

#Possible way to do the multiple files
#combined_data <-
#  list.files(path = here("data"), pattern = "*.csv") %>% 
#  map_df(~read_csv(.))

#This is the assessment document
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

This section of code joins the various datasets of interest to create the joined data.
It then filters based on the relevant requirements.  
```{r}
main_data <- full_join(data_aug2024, hb_data, by = join_by(hbt == hb)) %>% 
  full_join(., data_july2024)

antibiotic_data <- main_data %>% filter(str_detect(bnf_item_description, "VANCOMYCIN|FIDAXOMICIN")) %>% 
  group_by(hb_name, bnf_item_description) %>% 
  summarise(paid_quantity = sum(paid_quantity))
```
